package me.moomoo.anarchyexploitfixes;

import org.bukkit.Material;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.entity.ChestedHorse;
import org.bukkit.entity.Entity;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityPortalEvent;
import org.bukkit.event.player.PlayerCommandPreprocessEvent;
import org.bukkit.event.player.PlayerInteractAtEntityEvent;
import org.bukkit.plugin.java.JavaPlugin;
import org.bukkit.scheduler.BukkitRunnable;

public class DupeFixes implements Listener {
    FileConfiguration config = Main.getPlugin(Main.class).getConfig();
    @EventHandler
    private void onEntityPortalEvent(EntityPortalEvent evt) {
        if (config.getBoolean("PreventDonkeysFromGoingThroughPortals")) {
            Entity entity = evt.getEntity();
            if (config.getBoolean("DEBUG")) {
                Main.getPlugin(Main.class).getLogger().info("EntityPortalEvent  " + entity);
            }
            if (entity instanceof ChestedHorse) {
                if (((ChestedHorse) entity).isCarryingChest()) {
                    evt.setCancelled(true);
                    if (!config.getBoolean("NoConsoleOutput")) {
                        Main.getPlugin(Main.class).getLogger().info("Prevented a " + entity.toString() + " from going through portal");
                    }
                }
            }
        }
    }
    @EventHandler
    private void onEntityInteract(PlayerInteractAtEntityEvent evt) {
        if (config.getBoolean("DisableChestsOnDonkeys")) {
            if (evt.getRightClicked() instanceof ChestedHorse) {
                evt.setCancelled(true);
                (new BukkitRunnable() {
                    public void run() {
                        if (evt.getPlayer().getInventory().getItemInMainHand().getType() == Material.CHEST) {
                            ((ChestedHorse) evt.getRightClicked()).setCarryingChest(false);
                        }
                        ((ChestedHorse) evt.getRightClicked()).setCarryingChest(false);
                    }
                }).runTaskLater(Main.getPlugin(Main.class), 2L);
            }
        }
    }
}
