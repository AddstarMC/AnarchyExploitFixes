package me.moomoo.anarchyexploitfixes.modules.preventions;

import me.moomoo.anarchyexploitfixes.AnarchyExploitFixes;
import me.moomoo.anarchyexploitfixes.modules.AnarchyExploitFixesModule;
import org.bukkit.entity.EntityType;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.CreatureSpawnEvent;

import java.util.Arrays;
import java.util.HashSet;
import java.util.List;

public class DisableFish implements AnarchyExploitFixesModule, Listener {

    private final HashSet<EntityType> disabledFishes = new HashSet<>();

    public DisableFish() {
        List<String> configuredPreventedFish = AnarchyExploitFixes.getConfiguration().getList("preventions.prevent-ambient-fish-spawns.fish-types-to-prevent", Arrays.asList(
                "COD", "SALMON", "PUFFERFISH", "TROPICAL_FISH"
        ));
        if (AnarchyExploitFixes.getMCVersion() > 12) {
            for (String configuredFish : configuredPreventedFish) {
                try {
                    EntityType fish = EntityType.valueOf(configuredFish);
                    disabledFishes.add(fish);
                } catch (IllegalArgumentException exception) {
                    AnarchyExploitFixes.getLog().info("(" + name() + ") Fish of type '" + configuredFish + "' not recognized. Please use correct EntityType enums for your minecraft version!");
                }
            }
        }
    }

    @Override
    public String name() {
        return "prevent-ambient-fish-spawns";
    }

    @Override
    public String category() {
        return "preventions";
    }

    @Override
    public void enable() {
        AnarchyExploitFixes plugin = AnarchyExploitFixes.getInstance();
        plugin.getServer().getPluginManager().registerEvents(this, plugin);
    }

    @Override
    public boolean shouldEnable() {
        return (
                AnarchyExploitFixes.getConfiguration().getBoolean("preventions.prevent-ambient-fish-spawns.enable", true)
                && AnarchyExploitFixes.getMCVersion() > 12
        );
    }

    @EventHandler(priority = EventPriority.NORMAL, ignoreCancelled = true)
    private void onCreatureSpawn(CreatureSpawnEvent event) {
        if (disabledFishes.contains(event.getEntity().getType())) {
            event.setCancelled(true);
        }
    }
}
