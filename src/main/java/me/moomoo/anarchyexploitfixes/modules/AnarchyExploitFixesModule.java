package me.moomoo.anarchyexploitfixes.modules;

import com.comphenix.protocol.ProtocolLibrary;
import me.moomoo.anarchyexploitfixes.AnarchyExploitFixes;
import me.moomoo.anarchyexploitfixes.modules.recode.chat.*;
import me.moomoo.anarchyexploitfixes.modules.recode.command.CommandWhitelist;
import me.moomoo.anarchyexploitfixes.modules.recode.misc.FirstJoinMessage;
import me.moomoo.anarchyexploitfixes.modules.recode.misc.JoinLeaveMessages;
import me.moomoo.anarchyexploitfixes.modules.recode.misc.MaskKickMessages;
import me.moomoo.anarchyexploitfixes.modules.recode.misc.PreventSpamKick;
import me.moomoo.anarchyexploitfixes.modules.recode.options1b1t.*;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.*;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.CrashExploits.DispenserCrash;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.CrashExploits.EndGatewayCrash;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.CrashExploits.MultipleEnderdragons;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.DupeFixes.*;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.NetherPortals.PreventAllEntities;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.NetherPortals.PreventDroppedItems;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.NetherPortals.PreventFireworks;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.NetherPortals.PreventPortalTraps;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.PacketPatches.BoatFly;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.PacketPatches.CraftingRecipeLag;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.PacketPatches.NoCom;
import me.moomoo.anarchyexploitfixes.modules.recode.patches.PacketPatches.PacketFly;
import me.moomoo.anarchyexploitfixes.modules.recode.preventions.AntiBedTrap;
import org.bukkit.Bukkit;
import org.bukkit.event.HandlerList;
import org.bukkit.plugin.Plugin;

import java.util.HashSet;

public interface AnarchyExploitFixesModule {

    void enable();
    boolean shouldEnable();

    HashSet<AnarchyExploitFixesModule> modules = new HashSet<>();

    static void reloadModules() {
        modules.clear();
        Plugin plugin = AnarchyExploitFixes.getInstance();
        plugin.getServer().getScheduler().cancelTasks(plugin);
        if (Bukkit.getPluginManager().isPluginEnabled("ProtocolLib"))
            ProtocolLibrary.getProtocolManager().removePacketListeners(plugin);
        HandlerList.unregisterAll(plugin);

        // Chat
        modules.add(new BannedRegex());
        modules.add(new BannedWords());
        modules.add(new CharacterLimit());
        modules.add(new PreventChatSpam());
        modules.add(new PreventLinks());
        modules.add(new PreventLinkSpam());
        modules.add(new PreventUnicodeDot());
        modules.add(new ReplaceAt());

        // Command
        modules.add(new CommandWhitelist());
        modules.add(new FixChatCoIgnore());

        // 1b1t Options
        modules.add(new DistanceAwayToTP());
        modules.add(new HurtCommands());
        modules.add(new NickResetOnly());
        modules.add(new UseSparkHealth());

        // Misc
        modules.add(new FirstJoinMessage());
        modules.add(new JoinLeaveMessages());
        modules.add(new MaskKickMessages());
        modules.add(new PreventSpamKick());
        modules.add(new BypassSlots());
        modules.add(new DisableNCPGeyser());
        modules.add(new PlaceBedrock());
        modules.add(new SlowDupe());

        // Patches
        modules.add(new BookBan());
        modules.add(new BowBomb());
        modules.add(new Burrow());
        modules.add(new CommandSign());
        modules.add(new PreventPortalTraps());
        modules.add(new InvalidNames());
        modules.add(new GodMode());
        modules.add(new EndPortalDestruction());
        // Nether Portals
        modules.add(new PreventAllEntities());
        modules.add(new PreventDroppedItems());
        modules.add(new PreventFireworks());
        // Dupe fixes
        modules.add(new ChestedEntitiesInPortals());
        modules.add(new ChestsOnEntities()); // testing needed
        modules.add(new EndPortalDupe());
        modules.add(new ExpDupePatch1());
        modules.add(new ExpDupePatch2());
        // Crash Exploits
        modules.add(new DispenserCrash());
        modules.add(new EndGatewayCrash());
        modules.add(new MultipleEnderdragons());
        // Packet Patches
        modules.add(new BoatFly());
        modules.add(new NoCom());
        modules.add(new PacketFly());
        modules.add(new CraftingRecipeLag());

        // Preventions
        modules.add(new AntiBedTrap());

        for (AnarchyExploitFixesModule module : modules) {
            if (module.shouldEnable()) module.enable();
        }
    }
}
