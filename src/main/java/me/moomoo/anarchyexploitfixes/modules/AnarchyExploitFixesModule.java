package me.moomoo.anarchyexploitfixes.modules;

import com.comphenix.protocol.ProtocolLibrary;
import me.moomoo.anarchyexploitfixes.AnarchyExploitFixes;
import me.moomoo.anarchyexploitfixes.modules.bedrock.*;
import me.moomoo.anarchyexploitfixes.modules.chat.*;
import me.moomoo.anarchyexploitfixes.modules.chat.commandwhitelist.CommandWhitelist;
import me.moomoo.anarchyexploitfixes.modules.chunklimits.*;
import me.moomoo.anarchyexploitfixes.modules.dupepreventions.*;
import me.moomoo.anarchyexploitfixes.modules.elytra.*;
import me.moomoo.anarchyexploitfixes.modules.illegals.blocks.PeriodicallyRemoveIllegalBlocks;
import me.moomoo.anarchyexploitfixes.modules.illegals.blocks.RemoveIllegalBlocksOnChunkload;
import me.moomoo.anarchyexploitfixes.modules.illegals.blocks.RemoveUnnaturalSpawners;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.RemoveSpecificItemNames;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.RevertOverstacked;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.RevertUnbreakables;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.bannedblocks.BanSpecificBlocks;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.bannedblocks.PreventPlacingBannedBlocks;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.datavalues.IllegalGoldenApples;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.datavalues.RemoveSpecificDataValues;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.datavalues.RevertUnnaturalDataValues;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.enchantments.HigherEnchants;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.enchantments.InapplicableEnchants;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.enchantments.IncompatibleEnchants;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.enchantments.SpecificHigherEnchants;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.spawneggs.PreventUsingSpawnEggs;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.spawneggs.RemoveSpawnEggs;
import me.moomoo.anarchyexploitfixes.modules.misc.*;
import me.moomoo.anarchyexploitfixes.modules.options1b1t.*;
import me.moomoo.anarchyexploitfixes.modules.patches.*;
import me.moomoo.anarchyexploitfixes.modules.patches.crashexploits.DispenserCrash;
import me.moomoo.anarchyexploitfixes.modules.patches.crashexploits.EndGatewayCrash;
import me.moomoo.anarchyexploitfixes.modules.patches.crashexploits.MultipleEnderdragons;
import me.moomoo.anarchyexploitfixes.modules.patches.lagexploits.SnowballExploit;
import me.moomoo.anarchyexploitfixes.modules.patches.packetpatches.CraftingRecipeLag;
import me.moomoo.anarchyexploitfixes.modules.patches.packetpatches.PacketFly;
import me.moomoo.anarchyexploitfixes.modules.patches.packetpatches.boatfly.BoatFlyPatch;
import me.moomoo.anarchyexploitfixes.modules.patches.packetpatches.nocom.NoCom;
import me.moomoo.anarchyexploitfixes.modules.preventions.*;
import me.moomoo.anarchyexploitfixes.modules.preventions.netherportals.*;
import me.moomoo.anarchyexploitfixes.modules.preventions.withers.*;
import me.moomoo.anarchyexploitfixes.modules.redstone.DisableRedstoneOnLowTPS;
import me.moomoo.anarchyexploitfixes.modules.redstone.RateLimitLevers;
import org.bukkit.event.HandlerList;

import java.util.HashSet;

public interface AnarchyExploitFixesModule {

    String name();
    String category();
    void enable();
    boolean shouldEnable();

    HashSet<AnarchyExploitFixesModule> modules = new HashSet<>();

    static void reloadModules() {
        modules.clear();
        AnarchyExploitFixes plugin = AnarchyExploitFixes.getInstance();
        plugin.enabledModules.clear();
        plugin.getServer().getScheduler().cancelTasks(plugin);
        HandlerList.unregisterAll(plugin);
        if (plugin.getServer().getPluginManager().isPluginEnabled("ProtocolLib")) {
            ProtocolLibrary.getProtocolManager().removePacketListeners(plugin);
        } else {
            AnarchyExploitFixes.getLog().severe("Could not find ProtocolLib. Many gamebreaking exploits can not be patched without it.");
            AnarchyExploitFixes.getLog().severe("Download dependency at https://www.spigotmc.org/resources/protocollib.1997/ or disable in config (not recommended)");
        }

        /*
            Bedrock
        */
        modules.add(new FillNetherCeilingOnChunkload());
        modules.add(new FillNetherFloorOnChunkload());
        modules.add(new FillOverworldFloorOnChunkload());
        modules.add(new PeriodicallyFillNetherCeiling());
        modules.add(new PeriodicallyFillNetherFloor());
        modules.add(new PeriodicallyFillOverworldFloor());
        modules.add(new PreventGoingBelowBedrockFloor());
        /*
            Chat
        */
        modules.add(new BannedRegex());
        modules.add(new BannedWords());
        modules.add(new CharacterLimit());
        modules.add(new CommandWhitelist());
        modules.add(new FixChatCoIgnore());
        modules.add(new PreventChatSpam());
        modules.add(new PreventCommandSpam());
        modules.add(new PreventLinks());
        modules.add(new PreventLinkSpam());
        modules.add(new PreventUnicodeDot());
        modules.add(new ReplaceAt());
        /*
            Chunk Limits
        */
        modules.add(new BlockLimit());
        modules.add(new CustomEntityLimit());
        modules.add(new ExpBottleLimit());
        modules.add(new FallingBlockLimit());
        modules.add(new FallingBlocksLowTPS());
        modules.add(new VehicleLimit());
        modules.add(new NonLivingEntityLimit());
        modules.add(new DroppedItemLimit());
        /*
            Dupe Preventions
        */
        modules.add(new ChestedEntitiesInPortals());
        modules.add(new ChestsOnEntities());
        modules.add(new EndPortalDupe());
        modules.add(new ExpDupePatch1());
        modules.add(new ExpDupePatch2());
        /*
            Elytra
        */
        modules.add(new ElytraAtSpawn());
        modules.add(new ElytraGlobal());
        modules.add(new ElytraOnCeiling());
        modules.add(new NewChunksListener());
        modules.add(new ElytraPacketFly());
        /*
            Illegals
        */
        // Blocks
        modules.add(new RemoveIllegalBlocksOnChunkload());
        modules.add(new PeriodicallyRemoveIllegalBlocks());
        modules.add(new RemoveUnnaturalSpawners());
        // Items
        modules.add(new IllegalGoldenApples());
        modules.add(new RemoveSpecificDataValues());
        modules.add(new RevertUnnaturalDataValues());
        modules.add(new RemoveSpecificItemNames());
        modules.add(new RevertOverstacked());
        modules.add(new RevertUnbreakables());
        // Banned Blocks
        modules.add(new BanSpecificBlocks());
        modules.add(new PreventPlacingBannedBlocks());
        // Enchantments
        modules.add(new IncompatibleEnchants());
        modules.add(new HigherEnchants());
        modules.add(new SpecificHigherEnchants());
        modules.add(new InapplicableEnchants());
        // Spawn Eggs
        modules.add(new PreventUsingSpawnEggs());
        modules.add(new RemoveSpawnEggs());
        /*
            Misc
        */
        modules.add(new FirstJoinMessages());
        modules.add(new JoinLeaveMessages());
        modules.add(new MaskKickMessages());
        modules.add(new PreventSpamKick());
        modules.add(new KickPhraseListener());
        /*
            1b1t Options
        */
        modules.add(new DisableNCPGeyser());
        modules.add(new DistanceAwayToTP());
        modules.add(new HurtCommands());
        modules.add(new NickResetOnly());
        modules.add(new PlaceBedrock());
        modules.add(new SlowDupe());
        modules.add(new UseSparkHealth());
        /*
            Patches
        */
        modules.add(new BookBan());
        modules.add(new BowBomb());
        modules.add(new Burrow());
        modules.add(new CommandSign());
        modules.add(new EndPortalDestruction());
        modules.add(new GodMode());
        modules.add(new InvalidUserNames());
        modules.add(new TeleportCoordExploit());
        // Crash Exploits
        modules.add(new DispenserCrash());
        modules.add(new EndGatewayCrash());
        modules.add(new MultipleEnderdragons());
        // Lag Exploits
        modules.add(new SnowballExploit());
        // Packet Patches
        modules.add(new BoatFlyPatch());
        modules.add(new NoCom());
        modules.add(new PacketFly());
        modules.add(new CraftingRecipeLag());
        /*
            Preventions
        */
        modules.add(new AntiBedTrap());
        modules.add(new DisableFish());
        modules.add(new Explosions());
        modules.add(new NetherRoof());
        modules.add(new PreventNonSurvival());
        modules.add(new PreventOppedPlayers());
        // Nether Portals
        modules.add(new PreventAllEntitiesInPortals());
        modules.add(new PreventDroppedItemsInPortals());
        modules.add(new PreventFireworksInPortals());
        modules.add(new PreventPortalTraps());
        modules.add(new PreventProjectilesInPortals());
        // Withers
        modules.add(new DisableWitherSkulls());
        modules.add(new RemoveAllSkullsPeriodically());
        modules.add(new RemoveSkullsAfterXTicks());
        modules.add(new RemoveSkullsOnChunkload());
        modules.add(new RemoveSkullsOnChunkunload());
        modules.add(new WitherSpawningAtSpawn());
        /*
            Redstone
        */
        modules.add(new DisableRedstoneOnLowTPS());
        modules.add(new RateLimitLevers());

        for (AnarchyExploitFixesModule module : modules) {
            if (module.shouldEnable()) {
                module.enable();
                if (module.name() != null) {
                    plugin.enabledModules.put("("+module.category()+") "+module.name(), true);
                }
            } else {
                if (module.name() != null) {
                    plugin.enabledModules.put("(" + module.category() + ") "+module.name(), false);
                }
            }
        }
    }
}
