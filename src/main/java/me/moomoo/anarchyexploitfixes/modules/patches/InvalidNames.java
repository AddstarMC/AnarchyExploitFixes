package me.moomoo.anarchyexploitfixes.modules.patches;

import me.moomoo.anarchyexploitfixes.AnarchyExploitFixes;
import me.moomoo.anarchyexploitfixes.modules.AnarchyExploitFixesModule;
import org.bukkit.ChatColor;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.player.AsyncPlayerPreLoginEvent;

import java.util.logging.Logger;

public class InvalidNames implements AnarchyExploitFixesModule, Listener {

    private final Logger logger;
    public InvalidNames() {
        this.logger = AnarchyExploitFixes.getLog();
    }

    @Override
    public String name() {
        return "Prevent Invalid Usernames";
    }

    @Override
    public String category() {
        return "Patches";
    }

    @Override
    public void enable() {
        AnarchyExploitFixes plugin = AnarchyExploitFixes.getInstance();
        plugin.getServer().getPluginManager().registerEvents(this, plugin);
    }

    @Override
    public boolean shouldEnable() {
        return AnarchyExploitFixes.getConfiguration().getBoolean("patches.prevent-invalid-names", false);
    }

    @EventHandler(priority = EventPriority.NORMAL, ignoreCancelled = true)
    public void onLogin(AsyncPlayerPreLoginEvent event) {
        String joiningPlayerName = event.getName();

        if (    !joiningPlayerName.matches("[A-Za-z0-9_]+")
                || joiningPlayerName.length() < 1
                || joiningPlayerName.length() > 16
        ) {
            logger.warning("Not allowing Player '"+joiningPlayerName+"' to join because username is invalid.");
            event.disallow(AsyncPlayerPreLoginEvent.Result.KICK_OTHER, ChatColor.RED + "Invalid Username");
        }
    }
}
