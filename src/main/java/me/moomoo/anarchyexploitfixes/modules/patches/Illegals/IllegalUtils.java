package me.moomoo.anarchyexploitfixes.modules.patches.Illegals;

import me.moomoo.anarchyexploitfixes.utils.ItemUtils;
import org.bukkit.Bukkit;
import org.bukkit.block.ShulkerBox;
import org.bukkit.inventory.ItemStack;
import org.bukkit.inventory.meta.BlockStateMeta;

public class IllegalUtils {

    public static void iterateThroughShulker(ItemStack item) {
        // Warning: Enables a dupe exploit, reason why its disabled by default - Fix in a pr if you have time! -
        // https://cdn.discordapp.com/attachments/810446565822038016/858851144750989312/jbIAkzJ9CU.mp4
        if (!ItemUtils.isShulkerBox(item)) return;

        BlockStateMeta meta = (BlockStateMeta) item.getItemMeta();
        ShulkerBox shulkerBox = (ShulkerBox) meta.getBlockState();

        for (ItemStack itemInShulker : shulkerBox.getInventory()) {
            // do something
        }

        shulkerBox.update();
        meta.setBlockState(shulkerBox);
        item.setItemMeta(meta);
    }

    // TBA
    if (getConfig().getBoolean("StrictIllegalPrevention")) {
        Bukkit.getServer().getScheduler().runTaskTimer(this, () -> Bukkit.getWorlds().forEach(world -> world.getPlayers().forEach(player -> player.getInventory().forEach(this::revert))), 0L, 20L);
    }

}
