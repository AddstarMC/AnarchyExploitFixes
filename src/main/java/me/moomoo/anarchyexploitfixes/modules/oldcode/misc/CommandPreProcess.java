package me.moomoo.anarchyexploitfixes.modules.oldcode.misc;

import me.moomoo.anarchyexploitfixes.AnarchyExploitFixes;
import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.World;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerCommandPreprocessEvent;

import java.awt.*;

public class CommandPreProcess implements Listener {
    private final AnarchyExploitFixes plugin;
    public CommandPreProcess() {
        this.plugin = AnarchyExploitFixes.getInstance();
    }

    @EventHandler(priority = EventPriority.HIGHEST, ignoreCancelled = true)
    public void onCommandPreprocess(PlayerCommandPreprocessEvent event) {
        FileConfiguration config = plugin.getConfig();

        if (config.getBoolean("FixChatcoIgnoreBug") && event.getMessage().equalsIgnoreCase("/ignore")) {
            if (event.getPlayer().getLocale().startsWith("es")) {
                event.getPlayer().sendMessage(ChatColor.RED + "No agregaste un nombre de jugador...");
            } else {
                event.getPlayer().sendMessage(ChatColor.RED + "You didn't add a player name...");
            }
            event.setCancelled(true);
        }

        if (config.getBoolean("UseSparkhealth") && event.getMessage().equalsIgnoreCase("/tps")) {
            event.getPlayer().performCommand("spark health");
            event.setCancelled(true);

            Bukkit.getServer().getScheduler().runTaskLater(plugin, () -> {
                if (event.getPlayer().getLocale().startsWith("es")) {
                    event.getPlayer().sendMessage(ChatColor.GRAY + "Este no es el tamaño mundial, para el tipo /stats de tamaño mundial");
                } else {
                    event.getPlayer().sendMessage(ChatColor.GRAY + "This is not the world size, for world size type /stats");
                }
            }, 10L);
        }

        if (config.getBoolean("nickresetonly") && event.getMessage().toLowerCase().startsWith("/nick")) {
            if (!event.getMessage().equalsIgnoreCase("/nick off")) {
                if (event.getPlayer().getLocale().startsWith("es")) {
                    event.getPlayer().sendMessage(ChatColor.BLUE + "No puedes cambiar tu nick pero puedes restablecerlo escribiendo /nick off si tienes un nick viejo!");
                } else {
                    event.getPlayer().sendMessage(ChatColor.BLUE + "You can't change your nick but you may reset it by typing /nick off if you have a legacy nick!");
                }
                event.setCancelled(true);
            }
        }

        if (event.getMessage().toLowerCase().startsWith("/tpa ") || event.getMessage().equalsIgnoreCase("/tpa") || event.getMessage().toLowerCase().startsWith("/tpahere") || event.getMessage().toLowerCase().startsWith("/call") || event.getMessage().toLowerCase().startsWith("/ecall") || event.getMessage().toLowerCase().startsWith("/etpa") || event.getMessage().toLowerCase().startsWith("/tpask") || event.getMessage().toLowerCase().startsWith("/etpask")) {
            if (config.getBoolean("5000blocksawaytoteleport")) {
                if (!event.getPlayer().getWorld().getEnvironment().equals(World.Environment.THE_END)) {
                    Point p1 = new Point(event.getPlayer().getLocation().getBlockX(), event.getPlayer().getLocation().getBlockZ());
                    Point p2 = new Point(0, 0);
                    if (p1.distance(p2) < 5000) {
                        if (event.getPlayer().getLocale().startsWith("es")) {
                            event.getPlayer().sendMessage(ChatColor.BLUE + "Necesitas ser 5000 cuadras de spawn para teletransportarse!");
                        } else {
                            event.getPlayer().sendMessage(ChatColor.BLUE + "You need to be 5000 blocks away from spawn to teleport!");
                        }
                        event.setCancelled(true);
                    }
                }
            }
        }

        String msg = event.getMessage().toLowerCase();
        if (config.getBoolean("AllowOPStobypass")) {
            if (config.getBoolean("CommandWhitelist") && !config.getList("CommandsWhitelisted").contains(msg.split(" ")[0])) {
                if (!event.getPlayer().isOp()) {
                    if (event.getPlayer().getLocale().startsWith("es")) {
                        event.getPlayer().sendMessage(ChatColor.DARK_RED + "Mal comando. Tipo /help para todos los comandos.");
                    } else {
                        event.getPlayer().sendMessage(ChatColor.DARK_RED + "Bad command. Type /help for all commands.");
                    }
                    event.setCancelled(true);
                }
            }
        } else {
            if (config.getBoolean("CommandWhitelist") && !config.getList("CommandsWhitelisted").contains(msg.split(" ")[0])) {
                if (event.getPlayer().getLocale().startsWith("es")) {
                    event.getPlayer().sendMessage(ChatColor.DARK_RED + "Mal comando. Tipo /help para todos los comandos.");
                } else {
                    event.getPlayer().sendMessage(ChatColor.DARK_RED + "Bad command. Type /help for all commands.");
                }

                event.setCancelled(true);
            }
        }

        if (config.getBoolean("MakeSpecificCommandsHurtYou") && config.getList("HurtCommands").contains(msg.split(" ")[0])) {
            event.getPlayer().damage(10L);
            event.setCancelled(true);
        }
    }
}
